const translations = {
    'en': {
        // Sidebar & Common
        'new_chat': 'New Chat',
        'discover_gems': 'Discover Gems',
        'recent': 'Recent',
        'about_us': 'About Us',
        'language': 'Language',
        'user_feedback': 'User Feedback',
        'settings': 'Settings',
        'mobile_app': 'Mobile App',
        'tester': 'Demo',
        'select_language': 'Select Language',
        'turkish': 'Turkish',
        'english': 'English',
        'close': 'Close',
        'guest': 'Guest',
        'cancel': 'Cancel',
        'save': 'Save',
        'delete': 'Delete',
        'edit': 'Edit',
        'active': 'Active',
        'completed': 'Completed',
        'archived': 'Archived',

        // Settings Page
        'profile': 'My Profile',
        'general': 'General',
        'theme': 'Theme',
        'system': 'System',
        'dark': 'Dark',
        'light': 'Light',
        'chat_settings': 'Chat',
        'saved_prompts': 'Saved Prompts',
        'expand_sidebar': 'Expand Sidebar on Search',
        'manage': 'Manage',
        'subscription': 'Subscription',
        'terms_of_service': 'Terms of Service',
        'privacy_policy': 'Privacy Policy',
        'logout': 'Log Out',
        'name': 'Name',
        'email': 'Email address',
        'phone': 'Phone number',
        'save_changes': 'Save Changes',
        'logout_all': 'Log Out from all devices',
        'close_session': 'Close Session',
        'delete_account': 'Delete Account',
        'delete_action': 'Delete',

        // Profile Page
        'back_to_chat': 'Back to Chat',
        'active_chats': 'Active Chats',
        'connected_apis': 'Connected APIs',
        'ai_models': 'AI Models',
        'add_new': 'Add New',
        'no_api': 'No API added yet.',
        'recent_activity': 'Recent Activity',
        'view': 'View',
        'no_history': 'No chat history yet.',
        'edit_model': 'Edit Model',
        'update': 'Update',
        'model_name': 'Model Name',
        'model_type': 'Model Type',
        'api_key': 'API Key',
        'api_url': 'API URL (Optional)',

        // Chat Page
        'ask_ai': 'Ask AI..',
        'thinking': 'Thinking',
        'no_model': 'No Model',
        'disclaimer': 'AI can make mistakes, please verify information.',

        // AI Settings Page
        'add_ai': 'Add AI',
        'back_to_profile': 'Back to Profile',
        'add_new_model': 'Add New Model',
        'model_name_label': 'Model Name (e.g. Work Assistant)',
        'model_name_placeholder': 'Enter a name for the model',
        'api_key_placeholder': 'Paste your API key',
        'api_url_label': 'API URL (Optional)',
        'api_url_placeholder': 'Enter if using a custom API endpoint',
        'api_url_help': 'Required for OpenAI compatible proxy servers. Leave empty for standard use.',
        'add_model_btn': 'Add Model',

        // Search Page
        'search_placeholder': 'Search chats'
    },
    'tr': {
        // Sidebar & Common
        'new_chat': 'Yeni Sohbet',
        'discover_gems': 'Gem\'leri Keşfedin',
        'recent': 'En Son',
        'about_us': 'Hakkımızda',
        'language': 'Dil',
        'user_feedback': 'Kullanıcı Geri Bildirimi',
        'settings': 'Ayarlar',
        'mobile_app': 'Mobil Uygulama',
        'tester': 'Demo',
        'select_language': 'Dil Seçin',
        'turkish': 'Türkçe',
        'english': 'İngilizce',
        'close': 'Kapat',
        'guest': 'Misafir',
        'cancel': 'İptal',
        'save': 'Kaydet',
        'delete': 'Sil',
        'edit': 'Düzenle',
        'active': 'Aktif',
        'completed': 'Tamamlanan',
        'archived': 'Arşivlenmiş',

        // Settings Page
        'profile': 'Profilim',
        'general': 'Genel',
        'theme': 'Tema',
        'system': 'Sistem',
        'dark': 'Koyu',
        'light': 'Açık',
        'chat_settings': 'Sohbet',
        'saved_prompts': 'Kaydedilen İstemler',
        'expand_sidebar': 'Aramada Kenar Çubuğunu Genişlet',
        'manage': 'Yönet',
        'subscription': 'Abonelik',
        'terms_of_service': 'Hizmet Şartları',
        'privacy_policy': 'Gizlilik Politikası',
        'logout': 'Çıkış Yap',
        'name': 'İsim',
        'email': 'E-posta adresi',
        'phone': 'Telefon numarası',
        'save_changes': 'Değişiklikleri Kaydet',
        'logout_all': 'Tüm cihazlardan çıkış yap',
        'close_session': 'Oturumu Kapat',
        'delete_account': 'Hesabı Sil',
        'delete_action': 'Sil',

        // Profile Page
        'back_to_chat': 'Sohbet\'e Dön',
        'active_chats': 'Aktif Sohbet',
        'connected_apis': 'Bağlı API',
        'ai_models': 'Yapay Zeka Modelleri',
        'add_new': 'Yeni Ekle',
        'no_api': 'Henüz eklenmiş bir API yok.',
        'recent_activity': 'Son Aktiviteler',
        'view': 'Görüntüle',
        'no_history': 'Henüz sohbet geçmişi yok.',
        'edit_model': 'Model Düzenle',
        'update': 'Güncelle',
        'model_name': 'Model Adı',
        'model_type': 'Model Tipi',
        'api_key': 'API Anahtarı',
        'api_url': 'API URL (Opsiyonel)',

        // Chat Page
        'ask_ai': 'Yapay Zeka\'ya sorun..',
        'choose': 'Seçim',
        'no_model': 'Model Yok',
        'disclaimer': 'Yapay zeka hata yapabilir, lütfen bilgileri doğrulayın.',

        // AI Settings Page
        'add_ai': 'Yapay Zeka Ekle',
        'back_to_profile': 'Profile Dön',
        'add_new_model': 'Yeni Model Ekle',
        'model_name_label': 'Model Adı (Örn: İş Asistanı)',
        'model_name_placeholder': 'Model için bir isim belirleyin',
        'api_key_placeholder': 'API anahtarınızı yapıştırın',
        'api_url_label': 'API URL (Opsiyonel)',
        'api_url_placeholder': 'Özel bir API endpoint kullanıyorsanız girin',
        'api_url_help': 'OpenAI uyumlu proxy sunucular için gereklidir. Standart kullanım için boş bırakın.',
        'add_model_btn': 'Modeli Ekle',

        // Search Page
        'search_placeholder': 'Sohbet arayın'
    }
};

function updateLanguage(lang) {
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang;

    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                if (element.hasAttribute('placeholder')) {
                    element.placeholder = translations[lang][key];
                }
            } else {
                // Check if element has children that are not text nodes (like icons)
                const icon = element.querySelector('i, span.icon, span.material-symbols-rounded');
                if (icon) {
                    // If there is an icon, we assume the text is in a text node or a specific span
                    // But in my base.html I used <span class="text"> for text, which is good.
                    // For buttons like "Back to Profile" which has <i class="fas fa-arrow-left"></i> Profile Dön
                    // We need to be careful.
                    // Simplest way: wrap text in a span with data-i18n if possible, or handle here.
                    // Let's try to just update the text node if possible.

                    // Actually, for mixed content, it's better to structure HTML to have text in a span.
                    // I will update HTML to wrap text in spans where needed.
                    // But for now, if I replace innerHTML, I lose the icon.
                    // So I will only update textContent if no children, or look for specific structure.

                    // In base.html I used <span class="text" data-i18n="..."> so it's fine there.
                    // In ai_settings.html I need to be careful.

                    // If the element has data-i18n, I will replace its content. 
                    // If it has an icon, I should probably put data-i18n on a span NEXT to the icon.
                    element.textContent = translations[lang][key];
                } else {
                    element.textContent = translations[lang][key];
                }
            }
        }
    });

    // Update active class in modal if it exists
    const buttons = document.querySelectorAll('.lang-option');
    buttons.forEach(btn => {
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
}

document.addEventListener('DOMContentLoaded', function () {
    const savedLang = localStorage.getItem('language') || 'tr'; // Default to Turkish as per user request context implies Turkish user
    updateLanguage(savedLang);

    // Modal Logic
    const langModal = document.getElementById('language-modal');
    const langTrigger = document.getElementById('language-trigger');
    const closeModal = document.getElementById('close-lang-modal');
    const langOptions = document.querySelectorAll('.lang-option');

    if (langTrigger) {
        langTrigger.addEventListener('click', (e) => {
            e.preventDefault();
            if (langModal) langModal.classList.add('active');
        });
    }

    if (closeModal) {
        closeModal.addEventListener('click', () => {
            if (langModal) langModal.classList.remove('active');
        });
    }

    if (langModal) {
        langModal.addEventListener('click', (e) => {
            if (e.target === langModal) {
                langModal.classList.remove('active');
            }
        });
    }

    langOptions.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            updateLanguage(lang);
            if (langModal) langModal.classList.remove('active');
        });
    });
});
